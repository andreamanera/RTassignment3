\hypertarget{_keyboard_drive_obs_8cpp}{}\doxysection{src/\+Keyboard\+Drive\+Obs.cpp File Reference}
\label{_keyboard_drive_obs_8cpp}\index{src/KeyboardDriveObs.cpp@{src/KeyboardDriveObs.cpp}}


modality to drive the robot using the keyboard with obstacle avoidance  


{\ttfamily \#include \char`\"{}ros/ros.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}geometry\+\_\+msgs/\+Twist.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}sensor\+\_\+msgs/\+Laser\+Scan.\+h\char`\"{}}\newline
{\ttfamily \#include $<$termios.\+h$>$}\newline
Include dependency graph for Keyboard\+Drive\+Obs.\+cpp\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{_keyboard_drive_obs_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{_keyboard_drive_obs_8cpp_af5978fab9fa6dd4ced1c3a8ab1251f7b}{getch}} (void)
\begin{DoxyCompactList}\small\item\em function to have non-\/blocking keyboard input \end{DoxyCompactList}\item 
float \mbox{\hyperlink{_keyboard_drive_obs_8cpp_a8a98eed12f7274738a5ee23ee3ae47fc}{Distance}} (float obs\+\_\+dist\mbox{[}$\,$\mbox{]}, int val\+\_\+min, int val\+\_\+max)
\begin{DoxyCompactList}\small\item\em Distance function to check the minimum value in a fixed range of an array. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{_keyboard_drive_obs_8cpp_ac49fafbc5f138914847f7d2e562ce406}{check\+\_\+walls}} (const sensor\+\_\+msgs\+::\+Laser\+Scan\+::\+Const\+Ptr \&msg)
\begin{DoxyCompactList}\small\item\em check\+\_\+walls to select the closest obstacle and decide what to do \end{DoxyCompactList}\item 
void \mbox{\hyperlink{_keyboard_drive_obs_8cpp_a4227105bb03c672faac7dea0c3a781e9}{choose\+\_\+input}} (char input)
\begin{DoxyCompactList}\small\item\em function to associate the input from keyboard with the correct command \end{DoxyCompactList}\item 
void \mbox{\hyperlink{_keyboard_drive_obs_8cpp_a7f7d866eccdabe51bb16818a792618b1}{get\+\_\+input}} ()
\begin{DoxyCompactList}\small\item\em get\+\_\+input function to display commands and compute the velocity \end{DoxyCompactList}\item 
int \mbox{\hyperlink{_keyboard_drive_obs_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}{main}} (int argc, char $\ast$$\ast$argv)
\begin{DoxyCompactList}\small\item\em main \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{_keyboard_drive_obs_8cpp_adde9f51ddf0fb5c82c57b4075b6e9400}\label{_keyboard_drive_obs_8cpp_adde9f51ddf0fb5c82c57b4075b6e9400}} 
ros\+::\+Publisher \mbox{\hyperlink{_keyboard_drive_obs_8cpp_adde9f51ddf0fb5c82c57b4075b6e9400}{publisher}}
\begin{DoxyCompactList}\small\item\em Global publisher. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_keyboard_drive_obs_8cpp_accacf4e9263030d70ed79f8516c0eac5}\label{_keyboard_drive_obs_8cpp_accacf4e9263030d70ed79f8516c0eac5}} 
double \mbox{\hyperlink{_keyboard_drive_obs_8cpp_accacf4e9263030d70ed79f8516c0eac5}{velocity}} = 0.\+2
\begin{DoxyCompactList}\small\item\em Global variable for linear velocity. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_keyboard_drive_obs_8cpp_ad0f8b5cad9317f1389ce5ab84b9a8b28}\label{_keyboard_drive_obs_8cpp_ad0f8b5cad9317f1389ce5ab84b9a8b28}} 
double \mbox{\hyperlink{_keyboard_drive_obs_8cpp_ad0f8b5cad9317f1389ce5ab84b9a8b28}{turn\+\_\+velocity}} = 0.\+5
\begin{DoxyCompactList}\small\item\em Global variable for turn velocity. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_keyboard_drive_obs_8cpp_a5bcd692957aace1a21bfc205c67ec998}\label{_keyboard_drive_obs_8cpp_a5bcd692957aace1a21bfc205c67ec998}} 
int \mbox{\hyperlink{_keyboard_drive_obs_8cpp_a5bcd692957aace1a21bfc205c67ec998}{linear}} = 0
\begin{DoxyCompactList}\small\item\em Global variable for linear direction. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_keyboard_drive_obs_8cpp_a1ca7e9bd07214a8b29d24ef9b87b5a4f}\label{_keyboard_drive_obs_8cpp_a1ca7e9bd07214a8b29d24ef9b87b5a4f}} 
int \mbox{\hyperlink{_keyboard_drive_obs_8cpp_a1ca7e9bd07214a8b29d24ef9b87b5a4f}{angular}} =0
\begin{DoxyCompactList}\small\item\em Global variable for angular direction. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_keyboard_drive_obs_8cpp_aa78c78a33ff8aacecd1105f94444acd3}\label{_keyboard_drive_obs_8cpp_aa78c78a33ff8aacecd1105f94444acd3}} 
double \mbox{\hyperlink{_keyboard_drive_obs_8cpp_aa78c78a33ff8aacecd1105f94444acd3}{th}} = 1
\begin{DoxyCompactList}\small\item\em Global threshold for wall distance. \end{DoxyCompactList}\item 
\mbox{\Hypertarget{_keyboard_drive_obs_8cpp_af113e9b4ca3af68972dfd3df47898c83}\label{_keyboard_drive_obs_8cpp_af113e9b4ca3af68972dfd3df47898c83}} 
geometry\+\_\+msgs\+::\+Twist \mbox{\hyperlink{_keyboard_drive_obs_8cpp_af113e9b4ca3af68972dfd3df47898c83}{vel}}
\begin{DoxyCompactList}\small\item\em Global overall velocity. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
modality to drive the robot using the keyboard with obstacle avoidance 

\begin{DoxyAuthor}{Author}
Andrea Manera 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
1.\+0.\+0 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
12/03/2022
\end{DoxyDate}
Subscribes to\+: ~\newline
 /scan to detect obstacles

Publishes to\+:~\newline
 /cmd\+\_\+vel to publish the velocity of the robot

Description\+:

This node aims e user the possibility to drive the robot in the environment using the keyboard, but in this case we want also to provide automatic obstacle avoidance. Since the goal is partillay similar to what was done with the Keyboard\+Drive node, part of the code has been re-\/used for this node. 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{_keyboard_drive_obs_8cpp_ac49fafbc5f138914847f7d2e562ce406}\label{_keyboard_drive_obs_8cpp_ac49fafbc5f138914847f7d2e562ce406}} 
\index{KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}!check\_walls@{check\_walls}}
\index{check\_walls@{check\_walls}!KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}}
\doxysubsubsection{\texorpdfstring{check\_walls()}{check\_walls()}}
{\footnotesize\ttfamily void check\+\_\+walls (\begin{DoxyParamCaption}\item[{const sensor\+\_\+msgs\+::\+Laser\+Scan\+::\+Const\+Ptr \&}]{msg }\end{DoxyParamCaption})}



check\+\_\+walls to select the closest obstacle and decide what to do 


\begin{DoxyParams}{Parameters}
{\em msg} & contains the variables provided by the robot laser\\
\hline
\end{DoxyParams}
This function is used to check where the closest obstacle is (front left or right of the robot). Once we know where the closest obstacle is we can decide how to opportunetly modify the velocity of the robot. \mbox{\Hypertarget{_keyboard_drive_obs_8cpp_a4227105bb03c672faac7dea0c3a781e9}\label{_keyboard_drive_obs_8cpp_a4227105bb03c672faac7dea0c3a781e9}} 
\index{KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}!choose\_input@{choose\_input}}
\index{choose\_input@{choose\_input}!KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}}
\doxysubsubsection{\texorpdfstring{choose\_input()}{choose\_input()}}
{\footnotesize\ttfamily void choose\+\_\+input (\begin{DoxyParamCaption}\item[{char}]{input }\end{DoxyParamCaption})}



function to associate the input from keyboard with the correct command 


\begin{DoxyParams}{Parameters}
{\em input} & the input that we want to associate with the correct command\\
\hline
\end{DoxyParams}
This function is used to opportunetly manage the velocity, the input given by the user is associated with a specific operation thanks to a switch and so the velocity and the turn velocity are opportunetly modified \mbox{\Hypertarget{_keyboard_drive_obs_8cpp_a8a98eed12f7274738a5ee23ee3ae47fc}\label{_keyboard_drive_obs_8cpp_a8a98eed12f7274738a5ee23ee3ae47fc}} 
\index{KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}!Distance@{Distance}}
\index{Distance@{Distance}!KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}}
\doxysubsubsection{\texorpdfstring{Distance()}{Distance()}}
{\footnotesize\ttfamily float Distance (\begin{DoxyParamCaption}\item[{float}]{obs\+\_\+dist\mbox{[}$\,$\mbox{]},  }\item[{int}]{val\+\_\+min,  }\item[{int}]{val\+\_\+max }\end{DoxyParamCaption})}



Distance function to check the minimum value in a fixed range of an array. 


\begin{DoxyParams}{Parameters}
{\em obs\+\_\+dist\mbox{[}$\,$\mbox{]}} & the array \\
\hline
{\em val\+\_\+min} & the index from which we start the search \\
\hline
{\em val\+\_\+max} & the index at which we stop the search \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
dist\+\_\+min the minimum value in the range
\end{DoxyReturn}
This function through a for loop compare the elements of the selected range and returns the minimum one \mbox{\Hypertarget{_keyboard_drive_obs_8cpp_a7f7d866eccdabe51bb16818a792618b1}\label{_keyboard_drive_obs_8cpp_a7f7d866eccdabe51bb16818a792618b1}} 
\index{KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}!get\_input@{get\_input}}
\index{get\_input@{get\_input}!KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}}
\doxysubsubsection{\texorpdfstring{get\_input()}{get\_input()}}
{\footnotesize\ttfamily void get\+\_\+input (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



get\+\_\+input function to display commands and compute the velocity 

This function first of all display the menu with the commands with which the user can modify the direction and the velocity then call the function choose input to compute the new velocity and then asign the computed velocity to the elements of the variable vel \mbox{\Hypertarget{_keyboard_drive_obs_8cpp_af5978fab9fa6dd4ced1c3a8ab1251f7b}\label{_keyboard_drive_obs_8cpp_af5978fab9fa6dd4ced1c3a8ab1251f7b}} 
\index{KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}!getch@{getch}}
\index{getch@{getch}!KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}}
\doxysubsubsection{\texorpdfstring{getch()}{getch()}}
{\footnotesize\ttfamily int getch (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



function to have non-\/blocking keyboard input 

\begin{DoxyReturn}{Returns}
ch the input given from keyboard
\end{DoxyReturn}
This function is needed to avoid pressing enter after giving an input from keyboard, this function is part of teleop\+\_\+twist\+\_\+keyboard.\+cpp. \mbox{\Hypertarget{_keyboard_drive_obs_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}\label{_keyboard_drive_obs_8cpp_a3c04138a5bfe5d72780bb7e82a18e627}} 
\index{KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}!main@{main}}
\index{main@{main}!KeyboardDriveObs.cpp@{KeyboardDriveObs.cpp}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{int}]{argc,  }\item[{char $\ast$$\ast$}]{argv }\end{DoxyParamCaption})}



main 


\begin{DoxyParams}{Parameters}
{\em argc} & An integer argument count of the command line arguments \\
\hline
{\em argv} & An argument vector of the command line arguments \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
an integer 0 upon success
\end{DoxyReturn}
The main function contains the core part of the program 